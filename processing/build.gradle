/*
 * This file was generated by the Gradle 'init' task.
 */

configurations {
    tests
}

dependencies {
    compile project(':druid-core')
    compile project(':druid-hll')
    compile project(':extendedset')
    compile 'com.fasterxml.jackson.core:jackson-annotations:2.6.7'
    compile 'com.fasterxml.jackson.core:jackson-core:2.6.7'
    compile 'com.fasterxml.jackson.core:jackson-databind:2.6.7'
    compile 'org.roaringbitmap:RoaringBitmap:0.8.6'
    compile 'it.unimi.dsi:fastutil:8.1.0'
    compile 'com.ning:compress-lzf:1.0.4'
    compile('org.skife.config:config-magic:0.9') {
        exclude group: 'org.slf4j', module: 'slf4j-api'
    }
    compile 'commons-io:commons-io:2.5'
    compile 'com.google.errorprone:error_prone_annotations:2.3.2'
    compile 'com.ibm.icu:icu4j:54.1.1'
    compile 'org.mozilla:rhino:1.7R5'
    compile 'org.lz4:lz4-java:1.6.0'
    compile 'org.mapdb:mapdb:1.0.8'
    compile 'commons-lang:commons-lang:2.6'
    compile 'org.ow2.asm:asm:7.1'
    compile 'org.ow2.asm:asm-commons:7.1'
    compile 'org.checkerframework:checker-qual:2.5.7'
    compile 'org.apache.maven:maven-artifact:3.6.0'
    testCompile project(path: ':druid-core', configuration: 'tests')
    testCompile 'junit:junit:4.12'
    testCompile 'com.carrotsearch:junit-benchmarks:0.7.2'
    testCompile 'org.easymock:easymock:4.0.2'
    testCompile 'com.google.caliper:caliper:0.5-rc1'
    testCompile 'pl.pragmatists:JUnitParams:1.0.4'
    testCompile 'com.h2database:h2:1.4.182'
    testCompile 'com.google.guava:guava-testlib:16.0.1'
}

description = 'druid-processing'

task testsJar(type: Jar) {
    classifier = 'tests'
    from(sourceSets.test.output)
}

test {
    useJUnit {
        excludeCategories 'org.apache.druid.collections.test.annotation.Benchmark'
    }

    allJvmArgs = [
        '-Xmx512m',
        '-XX:MaxDirectMemorySize=2500m',
        '-Duser.language=en',
        '-Duser.GroupByQueryRunnerTest.javacountry=US',
        '-Dfile.encoding=UTF-8',
        '-Duser.timezone=UTC',
        '-Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager',
        '-Ddruid.indexing.doubleStorage=double', // TODO After fixing https://github.com/apache/incubator-druid/issues/4964 remove this parameter
    ]
}

task testBenchmark(type: Test) {
    useJUnit {
        includeCategories 'org.apache.druid.collections.test.annotation.Benchmark'
        excludeCategories 'org.apache.druid.collections.test.annotation.Dummy'
    }

    allJvmArgs = [
        '-server',
        '-Xms3G',
        '-Xmx3G',
        '-Djub.consumers=CONSOLE,H2',
        '-Djub.db.file=benchmarks/benchmarks',
    ]
}

// TODO add annotation processor

publishing.publications.maven.artifact(testsJar)

artifacts {
    tests testsJar
}
